<div class="inline-block">
  <h2 class="mt-4 text-2xl font-bold text-gray-900 dark:text-white flex items-center">
    Top Posts
    <span class="ml-1">
      <div data-tooltip-target="top-posts-tooltip">
        <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-pointer" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h1m0-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
    </span>
  </h2>
</div>
<div id="top-posts-tooltip" role="tooltip" class="inline-block absolute invisible z-10 py-2 px-3 text-sm font-medium text-white bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
    Will show up to the last <%= @maximum_days_of_data %> days of tweets as the data is available showing the highest impressions first
    <div class="tooltip-arrow" data-popper-arrow></div>
</div>

<div class="w-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6 mt-4 overflow-auto">
    <table class="w-full text-sm text-center text-gray-500 dark:text-gray-400">
        <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
            <tr>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Post
                </th>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Retweets
                </th>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Quotes
                </th>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Likes
                </th>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Replies
                </th>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Impressions
                </th>
                <th scope="col" class="p-1 whitespace-nowrap">
                    Engagement Rate
                </th>
            </tr>
        </thead>
        <tbody>
          <% @top_posts.each do |tweet_metric| %>
              <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                    <td class="p-1 whitespace-nowrap">
                      <a href="https://twitter.com/user/status/<%= tweet_metric.tweet.twitter_id %>" target="_blank" class="text-blue-600 hover:text-blue-900">
                      <%= text_with_images(tweet_metric.tweet.text) %>
                      </a>
                  </td>
                  <td class="p-1">
                      <%= tweet_metric.retweet_count %>
                  </td>
                  <td class="p-1">
                      <%= tweet_metric.quote_count %>
                  </td>
                  <td class="p-1">
                      <%= tweet_metric.like_count %>
                  </td>
                  <td class="p-1">
                      <%= tweet_metric.reply_count %>
                  </td>
                  <td class="p-1">
                      <%= tweet_metric.impression_count %>
                  </td>
                 <td class="px-6 py-4 relative">
                 <div class="engagement-rate-cell">
                  <%= tweet_metric.engagement_rate_percentage %>%
                  <div data-tooltip-target="tooltip-engagement-<%= tweet_metric.tweet.id %>" class="ml-2">
                    <svg class="w-4 h-4 text-gray-400 hover:text-gray-600 cursor-pointer" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h1m0-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  </div>
                  <div id="tooltip-engagement-<%= tweet_metric.tweet.id %>" role="tooltip" class="tooltip absolute z-10 invisible bg-gray-900 text-white p-2 rounded-lg shadow-lg text-xs">
                    Engagement rate is calculated as (interactions / impressions) * 100. For this tweet:
                    <%= '(%.2f + %.2f + %.2f + %.2f + %.2f) / %.2f * 100' % [tweet_metric.retweet_count || 0, tweet_metric.quote_count || 0, tweet_metric.like_count || 0, tweet_metric.reply_count || 0, tweet_metric.bookmark_count || 0, tweet_metric.impression_count || 0] %> = <%= tweet_metric.engagement_rate_percentage %>
                    <div class="tooltip-arrow" data-popper-arrow></div>
                  </div>
                </td>
              </tr>
          <% end %>
        </tbody>
    </table>
</div>